<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CORE | COMMAND CENTER</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Space+Grotesk:wght@300;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
   <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#00F3FF">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
</head>
<body>

    <nav class="glass-panel" style="position: fixed; top: 0; width: 100%; z-index: 100;">
        <div class="logo">C.O.R.E <span class="blink">_</span></div>
        <div class="user-menu">
            <button onclick="logout()" class="btn-secondary" style="font-size: 0.7rem; padding: 0.5rem 1rem;">TERMINATE SESSION</button>
        </div>
    </nav>

    <div class="dashboard-container">
        <aside class="sidebar">
            <a href="#" class="active"><i class="fa-solid fa-chart-line"></i> OVERVIEW</a>
            <a href="learning.html"><i class="fa-solid fa-graduation-cap"></i> LEARNING HUB</a>
            <a href="community.html"><i class="fa-solid fa-users"></i> COMMUNITY</a>
            <a href="project.html"><i class="fa-solid fa-microchip"></i> PROJECT LAB</a>
            <a href="leaderboard.html"><i class="fa-solid fa-trophy"></i> LEADERBOARD</a>
            <a href="about.html"><i class="fa-solid fa-circle-info"></i> SYSTEM INFO</a>
        </aside>

        <main class="main-content">
            <div class="welcome-banner">
                <span class="user-rank">CURRENT RANK: EXPLORER</span>
                <h1 id="user-greeting">WELCOME BACK, PILOT</h1>
                <p>SYSTEM SYSTEMS NOMINAL. READY FOR INSTRUCTION.</p>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <span class="stat-number" style="color: var(--neon-cyan);">0</span>
                    <span class="stat-label">PROJECTS BUILT</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="points-display" style="color: var(--neon-blue);">0</span>
                    <span class="stat-label">INNOVATION POINTS</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="modules-display" style="color: gold;">0</span>
                    <span class="stat-label">MODULES ACTIVE</span>
                </div>
            </div>

            <div class="section-header">
                <h2>ACTIVE DIRECTIVES</h2>
                <div class="line"></div>
            </div>
            
            <div class="card glass-panel" style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <h3 style="color: var(--neon-cyan); margin-bottom: 0.5rem;">MISSION 1: SYSTEM INITIALIZATION</h3>
                    <p>Access the Learning Hub to begin your training.</p>
                </div>
                <button class="btn-primary" onclick="window.location.href='learning.html'">BEGIN</button>
            </div>
        </main>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
    
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
    
    <script src="firebase-config.js"></script>

    <script>
                // Check Login Status
       // Check Login Status
        auth.onAuthStateChanged(user => {
            if (user) {
                // --- 1. ADMIN CHECK (SECRET BUTTON) ---
                const ADMIN_EMAIL = "futurevisioual2020@gmail.com"; // <--- YOUR EMAIL
                if (user.email === ADMIN_EMAIL) {
                    const sidebar = document.querySelector('.sidebar');
                    sidebar.innerHTML += `
                        <a href="admin.html" style="border: 1px solid red; color: red; margin-top: 2rem;">
                            <i class="fa-solid fa-lock"></i> ADMIN PANEL
                        </a>
                    `;
                }

                // --- 2. LOAD DASHBOARD DATA (For Everyone) ---
                console.log("AUTHORIZED: " + user.email);
                document.getElementById('user-greeting').innerText = "WELCOME BACK, " + user.email.split('@')[0].toUpperCase();

                // Get Data from Database
                db.collection('users').doc(user.uid).get().then((doc) => {
                    if (doc.exists) {
                        const data = doc.data();
                        document.getElementById('points-display').innerText = data.points || 0;
                        document.getElementById('modules-display').innerText = data.modules_completed || 0;
                        document.querySelector('.user-rank').innerText = "CURRENT RANK: " + (data.rank || "EXPLORER");
                    }
                });

            } else {
                // --- 3. NO USER DETECTED -> KICK OUT ---
                window.location.href = "index.html";
            }
        });

        function logout() {
            auth.signOut().then(() => { window.location.href = "index.html"; });
        }
    </script>
</body>
</html>